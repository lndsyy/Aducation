<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AduCation</title>
<script src="https://cdn.tailwindcss.com"></script>

<!-- PWA manifest -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000080">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
/* Basic styling */
body {
  font-family: 'Inter', sans-serif;
  background-color: #001440;
  color: #FFFFFF;
}
.hidden { display: none; }
.task-dot { width: 6px; height: 6px; border-radius: 50%; display: inline-block; margin: 0 2px; }
.task-tooltip { display: none; position: absolute; top: 2rem; left: 50%; transform: translateX(-50%); background-color: #979696; color: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.7rem; z-index: 10; }
.calendar-day { position: relative; cursor: pointer; padding: 0.5rem; text-align: center; border-radius: 0.25rem; }
.calendar-day.today { background-color: #9c9b9b; color: white; }
.calendar-day:hover .task-tooltip { display: block; }
button { cursor: pointer; }
footer.audio-footer { background-color: #000080; padding: 0.5rem; }
</style>
</head>
<body class="min-h-screen flex flex-col md:flex-row">

<!-- Sidebar -->
<aside class="w-full md:w-64 bg-[#001440] border-r border-[#777777] flex flex-col justify-between p-4">
  <div>
    <div class="font-bold text-xl mb-4 text-center md:text-left">AdUcation</div>
    <div class="flex flex-wrap md:flex-col gap-2">
      <!-- Navigation buttons -->
      <button id="btnDashboard" class="w-full px-3 py-2 rounded bg-[#777777] hover:bg-[#555555]">Dashboard</button>
      <button id="btnTimer" class="w-full px-3 py-2 rounded bg-[#777777] hover:bg-[#555555]">Timer</button>
      <button id="btnTasks" class="w-full px-3 py-2 rounded bg-[#777777] hover:bg-[#555555]">All Tasks</button>
      <button id="btnPlaylist" class="w-full px-3 py-2 rounded bg-[#777777] hover:bg-[#555555]">Playlist</button>
    </div>
  </div>

  <!-- Audio player at the bottom -->
  <footer class="audio-footer mt-4">
    <audio id="audioPlayer" controls class="w-full"></audio>
  </footer>
</aside>

<!-- Main Content -->
<main class="flex-grow p-4 md:p-6 overflow-y-auto">

  <!-- Dashboard -->
  <div id="dashboardSection">
    <h2 class="text-2xl font-bold mb-4">Welcome Back, Student!</h2>

    <!-- Stats -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
      <div class="p-4 rounded shadow text-center bg-[#777777]">
        <p class="text-sm">Total Study Hours</p>
        <p id="studyHours" class="text-3xl font-bold text-white-400">0</p>
      </div>
      <div class="p-4 rounded shadow text-center bg-[#777777]">
        <p class="text-sm">Total Tasks</p>
        <p id="totalTasks" class="text-3xl font-bold text-white-400">0</p>
      </div>
      <div class="p-4 rounded shadow text-center bg-[#777777]">
        <p class="text-sm">Pomodoro Sessions</p>
        <p id="pomodoroSessions" class="text-3xl font-bold text-white-400">0</p>
      </div>
    </div>

    <!-- Task Input -->
    <div class="p-4 rounded shadow mb-6 bg-[#777777]">
      <h3 class="font-bold text-lg mb-3">Add New Task</h3>
      <form id="taskForm" class="flex flex-col sm:flex-row gap-2">
        <input id="taskName" type="text" placeholder="Task name" class="p-2 rounded flex-grow text-black" required>
        <input id="taskDate" type="date" class="p-2 rounded text-black" required>
        <select id="taskPriority" class="p-2 rounded text-black">
          <option value="High">High</option>
          <option value="Medium" selected>Medium</option>
          <option value="Low">Low</option>
        </select>
        <button type="submit" class="px-4 py-2 rounded bg-[#000080] text-white hover:bg-[#5555aa]">Add Task</button>
      </form>
    </div>

    <!-- Tasks Today -->
    <div id="taskListContainer" class="p-4 rounded shadow mb-6 bg-[#777777]">
      <h3 class="font-bold text-lg mb-3">Tasks Today</h3>
      <ul id="todayTasks"></ul>
    </div>

    <!-- Calendar -->
    <div class="p-4 rounded shadow bg-[#777777]">
      <div class="flex justify-between mb-2">
        <button id="prevMonth" class="px-2 py-1 bg-[#001440] rounded">Prev</button>
        <div id="monthYear" class="font-bold"></div>
        <button id="nextMonth" class="px-2 py-1 bg-[#001440] rounded">Next</button>
      </div>
      <div class="grid grid-cols-7 text-xs font-bold text-[#FFFFFF] mb-1">
        <span>Sun</span><span>Mon</span><span>Tue</span><span>Wed</span>
        <span>Thu</span><span>Fri</span><span>Sat</span>
      </div>
      <div id="calendarDays" class="grid grid-cols-7 gap-1"></div>
    </div>
  </div>

  <!-- Timer -->
  <div id="timerSection" class="hidden mt-6">
    <h2 class="text-2xl font-bold mb-4">Pomodoro Timer</h2>
    <div class="p-4 rounded shadow text-center bg-[#777777]">
      <p id="timerDisplay" class="text-4xl font-bold mb-4">25:00</p>
      <button id="startTimer" class="px-4 py-2 bg-green-500 rounded hover:bg-green-400">Start</button>
      <button id="pauseTimer" class="px-4 py-2 bg-yellow-500 rounded hover:bg-yellow-400 ml-2">Pause</button>
      <button id="resetTimer" class="px-4 py-2 bg-red-500 rounded hover:bg-red-400 ml-2">Reset</button>
    </div>
  </div>

  <!-- All Tasks -->
  <div id="tasksSection" class="hidden mt-6">
    <h2 class="text-2xl font-bold mb-4">All Tasks</h2>
    <div id="allTasksList" class="p-4 rounded shadow bg-[#777777]"></div>
  </div>

  <!-- Playlist -->
  <div id="playlistSection" class="hidden mt-6">
    <h2 class="text-2xl font-bold mb-4">Study Playlist</h2>
    <div class="p-4 rounded shadow bg-[#777777]">
      <ul id="playlistSongs" class="space-y-2">
        <li class="cursor-pointer hover:text-blue-400" onclick="playSong('Usher - Burn.mp3')">Burn - Usher</li>
        <li class="cursor-pointer hover:text-blue-400" onclick="playSong('Kendrick Lamar, SZA - luther.mp3')">Luther - Kendrick Lamar, SZA</li>
        <li class="cursor-pointer hover:text-blue-400" onclick="playSong('Brown Eyes - Destiny\'s Child.mp3')">Brown Eyes - Destiny's Child</li>
      </ul>
    </div>
  </div>

</main>

<script>
// ======= Data =======
let tasks = JSON.parse(localStorage.getItem('tasks') || '{}');
let studyHours = parseFloat(localStorage.getItem('studyHours') || '0');
let pomodoroCount = parseInt(localStorage.getItem('pomodoroCount') || '0');
let currentDate = new Date();
let timerDuration = 25*60, timer = timerDuration, timerInterval = null;

// ======= Elements =======
const dashboardSection = document.getElementById('dashboardSection');
const timerSection = document.getElementById('timerSection');
const tasksSection = document.getElementById('tasksSection');
const playlistSection = document.getElementById('playlistSection');
const todayTasksUl = document.getElementById('todayTasks');
const allTasksDiv = document.getElementById('allTasksList');
const monthYear = document.getElementById('monthYear');
const calendarDays = document.getElementById('calendarDays');
const timerDisplay = document.getElementById('timerDisplay');

// ======= Helpers =======
function pad(n){ return n<10?'0'+n:n; }
function formatStudyTime(hoursFloat) {
  let hours = Math.floor(hoursFloat);
  let minutes = Math.round((hoursFloat - hours)*60);
  if(minutes===60){hours++;minutes=0;}
  return `${hours} hr${hours!==1?'s':''} ${minutes} min${minutes!==1?'s':''}`;
}

// ======= Navigation =======
document.getElementById('btnDashboard').onclick = () => {
  dashboardSection.classList.remove('hidden');
  timerSection.classList.add('hidden');
  tasksSection.classList.add('hidden');
  playlistSection.classList.add('hidden');
};
document.getElementById('btnTimer').onclick = () => {
  dashboardSection.classList.add('hidden');
  timerSection.classList.remove('hidden');
  tasksSection.classList.add('hidden');
  playlistSection.classList.add('hidden');
};
document.getElementById('btnTasks').onclick = () => {
  dashboardSection.classList.add('hidden');
  timerSection.classList.add('hidden');
  tasksSection.classList.remove('hidden');
  playlistSection.classList.add('hidden');
};
document.getElementById('btnPlaylist').onclick = () => {
  dashboardSection.classList.add('hidden');
  timerSection.classList.add('hidden');
  tasksSection.classList.add('hidden');
  playlistSection.classList.remove('hidden');
};

// ======= Audio Player =======
function playSong(src) {
  const audioPlayer = document.getElementById('audioPlayer');
  audioPlayer.src = src;
  audioPlayer.play();
  // Highlight current song
  const items = document.querySelectorAll('#playlistSongs li');
  items.forEach(li => li.classList.remove('font-bold', 'text-green-400'));
  const current = Array.from(items).find(li => li.getAttribute('onclick').includes(src));
  if (current) current.classList.add('font-bold', 'text-green-400');
}

// ======= Stats =======
function updateStats(){
  document.getElementById('studyHours').textContent = formatStudyTime(studyHours);
  document.getElementById('pomodoroSessions').textContent = pomodoroCount;
  let total = 0; Object.values(tasks).forEach(arr=>total+=arr.length);
  document.getElementById('totalTasks').textContent = total;

  todayTasksUl.innerHTML='';
  const todayStr = new Date().toISOString().split('T')[0];
  if(tasks[todayStr]){
    tasks[todayStr].forEach(t=>{
      let li=document.createElement('li');
      li.textContent=t.text;
      li.className = t.priority==='High'?'text-red-400':t.priority==='Medium'?'text-orange-400':'text-yellow-400';
      todayTasksUl.appendChild(li);
    });
  }
}

// ======= Add Task =======
document.getElementById('taskForm').onsubmit = function(e){
  e.preventDefault();
  const name = document.getElementById('taskName').value.trim();
  const date = document.getElementById('taskDate').value;
  const priority = document.getElementById('taskPriority').value;
  if(!tasks[date]) tasks[date]=[];
  tasks[date].push({text:name,priority});
  localStorage.setItem('tasks',JSON.stringify(tasks));
  document.getElementById('taskName').value='';
  renderAllTasks(); updateStats(); renderCalendar();
}

// ======= Render Tasks =======
function renderAllTasks(){
  allTasksDiv.innerHTML='';
  const dates = Object.keys(tasks).sort();
  if(dates.length===0){allTasksDiv.innerHTML='<p>No tasks yet.</p>';return;}
  for(let date of dates){
    let div=document.createElement('div'); div.className='mb-3 p-2 bg-[#777777] rounded';
    let h4=document.createElement('h4'); h4.className='font-semibold mb-1'; h4.textContent=new Date(date).toLocaleDateString(); div.appendChild(h4);
    for(let i=0;i<tasks[date].length;i++){
      let t=tasks[date][i];
      let p=document.createElement('div'); p.className='ml-2 ' + (t.priority==='High'?'text-red-400':t.priority==='Medium'?'text-orange-400':'text-yellow-400');
      p.textContent='• '+t.text;
      let delBtn=document.createElement('button'); delBtn.textContent='✕'; delBtn.className='ml-2 text-xs text-gray-200 hover:text-red-400';
      delBtn.onclick=()=>{tasks[date].splice(i,1); if(tasks[date].length===0) delete tasks[date]; localStorage.setItem('tasks',JSON.stringify(tasks)); renderAllTasks(); updateStats(); renderCalendar();}
      p.appendChild(delBtn); div.appendChild(p);
    }
    allTasksDiv.appendChild(div);
  }
}

// ======= Calendar =======
function renderCalendar(){
  calendarDays.innerHTML='';
  const year=currentDate.getFullYear(), month=currentDate.getMonth();
  monthYear.textContent=currentDate.toLocaleString('default',{month:'long',year:'numeric'});
  const firstDay=new Date(year,month,1).getDay();
  const lastDate=new Date(year,month+1,0).getDate();
  for(let i=0;i<firstDay;i++) calendarDays.innerHTML+='<div></div>';
  for(let d=1;d<=lastDate;d++){
    let div=document.createElement('div'); div.className='calendar-day'; 
    let dateStr=`${year}-${pad(month+1)}-${pad(d)}`;
    div.textContent=d; div.dataset.date=dateStr;
    if(new Date().toISOString().split('T')[0]===dateStr) div.classList.add('today');
    if(tasks[dateStr]){
      let dotsDiv=document.createElement('div'); dotsDiv.style.marginTop='4px';
      tasks[dateStr].forEach(t=>{let dot=document.createElement('span'); dot.className='task-dot'; dot.style.backgroundColor=t.priority==='High'?'red':t.priority==='Medium'?'orange':'yellow'; dotsDiv.appendChild(dot);});
      div.appendChild(dotsDiv);
      let tooltip=document.createElement('div'); tooltip.className='task-tooltip';
      tasks[dateStr].forEach(t=>{let p=document.createElement('div'); p.textContent=t.text; tooltip.appendChild(p);});
      div.appendChild(tooltip);
    }
    calendarDays.appendChild(div);
  }
}
document.getElementById('prevMonth').onclick=()=>{currentDate.setMonth(currentDate.getMonth()-1); renderCalendar();}
document.getElementById('nextMonth').onclick=()=>{currentDate.setMonth(currentDate.getMonth()+1); renderCalendar();}

// ======= Pomodoro Timer =======
let sessionActive=false,lastTickTime=null;
function updateTimerDisplay(){timerDisplay.textContent=`${pad(Math.floor(timer/60))}:${pad(timer%60)}`;}
function updateStudyHoursLive(){if(!sessionActive||!lastTickTime)return; const now=Date.now(); const elapsed=(now-lastTickTime)/1000; studyHours+=elapsed/3600; localStorage.setItem('studyHours',studyHours.toFixed(3)); lastTickTime=now; updateStats();}
document.getElementById('startTimer').onclick=function(){if(sessionActive)return; sessionActive=true; lastTickTime=Date.now(); timerInterval=setInterval(()=>{updateStudyHoursLive(); if(timer>0){timer--;updateTimerDisplay();}else{clearInterval(timerInterval);timerInterval=null;sessionActive=false; pomodoroCount++;localStorage.setItem('pomodoroCount',pomodoroCount);studyHours+=25/60;localStorage.setItem('studyHours',studyHours.toFixed(3));updateStats();timer=timerDuration;updateTimerDisplay();}},1000);};
document.getElementById('pauseTimer').onclick=()=>{if(!sessionActive)return; updateStudyHoursLive(); clearInterval(timerInterval); timerInterval=null; sessionActive=false;}
document.getElementById('resetTimer').onclick=()=>{updateStudyHoursLive(); clearInterval(timerInterval); timerInterval=null; sessionActive=false; timer=timerDuration; updateTimerDisplay();}

// ======= Init =======
updateStats(); renderAllTasks(); renderCalendar(); updateTimerDisplay();

// ======= PWA Service Worker =======
if ("serviceWorker" in navigator) {
  window.addEventListener("load", function() {
    navigator.serviceWorker.register("service-worker.js")
      .then(reg => { console.log("SW registered:", reg.scope); })
      .catch(err => { console.log("SW registration failed:", err); });
  });
}

</script>
</body>
</html>
